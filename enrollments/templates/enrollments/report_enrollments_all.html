<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Matriculaciones por curso</title>
<style>
  body{font-family: DejaVu Sans, Arial, sans-serif; font-size:12px}
  h1{margin:0 0 8px 0}
  h3{margin:12px 0 6px 0}
  .muted{color:#666; font-size:11px; margin-bottom:8px}
  table{width:100%; border-collapse:collapse; margin:8px 0}
  th,td{border:1px solid #999; padding:6px; text-align:left}
  th{background:#f0f0f0}
</style>
</head>
<body>
  <h1>Matriculaciones por curso</h1>
  <div class="muted">Generado: {{ generated_at }}</div>

  <!-- Ranking por cantidad -->
  <table>
    <tr><th>#</th><th>Código</th><th>Curso</th><th>Total alumnos</th></tr>
    {% for c in courses %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ c.code }}</td>
        <td>{{ c.title }}</td>
        <td>{{ c.total }}</td>
      </tr>
    {% endfor %}
  </table>

  <!-- Detalle por curso -->
  {% for c in courses %}
    <h3>{{ c.code }} — {{ c.title }} ({{ c.total }})</h3>
    <table>
      <tr><th>#</th><th>Apellido</th><th>Nombre</th><th>Email</th><th>Cédula</th><th>Fecha</th></tr>
      {% for e in c.enrollment_set.all %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ e.student.last_name }}</td>
        <td>{{ e.student.first_name }}</td>
        <td>{{ e.student.email }}</td>
        <td>{{ e.student.id_number }}</td>
        <td>{{ e.enrolled_at|date:"d/m/Y H:i" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6">Sin inscriptos</td></tr>
      {% endfor %}
    </table>
  {% endfor %}
</body>
</html>
